# loadtestlog

‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö **Load Testing** ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ InfluxDB +
Grafana ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á Logging ‡∏ú‡πà‡∏≤‡∏ô Loki ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ú‡πà‡∏≤‡∏ô Docker Compose
‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

------------------------------------------------------------------------

## üìå Prerequisites

-   Docker + Docker Compose
-   k6 (‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡∏£‡∏±‡∏ô‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)
-   ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô container ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î port

------------------------------------------------------------------------

## üóÇÔ∏è ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå

    loadtestlog/
    ‚îÇ-- compose/
    ‚îÇ   ‚îÇ-- docker-compose.yml
    ‚îÇ   ‚îÇ-- docker-compose.infra.yml
    ‚îÇ   ‚îÇ-- docker-compose.grafana.yml
    ‚îÇ
    ‚îÇ-- k6/
    ‚îÇ   ‚îÇ-- scripts/
    ‚îÇ       ‚îÇ-- sample-test.js
    ‚îÇ   ‚îÇ-- outputs/
    ‚îÇ       ‚îÇ-- influxdb.json
    ‚îÇ
    ‚îÇ-- grafana/
    ‚îÇ   ‚îÇ-- dashboards/
    ‚îÇ   ‚îÇ-- provisioning/
    ‚îÇ
    ‚îÇ-- loki/
    ‚îÇ   ‚îÇ-- config.yml
    ‚îÇ
    ‚îÇ-- influxdb/
    ‚îÇ   ‚îÇ-- influxdb.conf
    ‚îÇ
    ‚îî‚îÄ‚îÄ README.md

------------------------------------------------------------------------

## üõ†Ô∏è ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Load Test

### 1Ô∏è‚É£ Clone ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå

    git clone https://github.com/sutin1990/loadtestlog.git
    cd loadtestlog

------------------------------------------------------------------------

## 2Ô∏è‚É£ Start Infrastructure (InfluxDB + Loki + Grafana)

‡πÉ‡∏ä‡πâ compose ‡∏£‡∏ß‡∏° infrastructure:

    docker compose -f compose/docker-compose.infra.yml up -d

‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:

  Service    Port   Description
  ---------- ------ ---------------------
  InfluxDB   8086   ‡πÄ‡∏Å‡πá‡∏ö metrics ‡∏à‡∏≤‡∏Å k6
  Grafana    3000   Dashboard
  Loki       3100   ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡πá‡∏ö log
  Promtail   9080   ‡∏™‡πà‡∏á log ‡πÑ‡∏õ Loki

------------------------------------------------------------------------

## 3Ô∏è‚É£ Start Grafana Environment

    docker compose -f compose/docker-compose.grafana.yml up -d

‡πÄ‡∏õ‡∏¥‡∏î Grafana ‡∏ó‡∏µ‡πà\
üëâ http://localhost:3000\
user/pass: `admin/admin` (‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)

------------------------------------------------------------------------

# üìà ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Grafana: InfluxDB + Loki

## 4Ô∏è‚É£ ‡πÄ‡∏û‡∏¥‡πà‡∏° InfluxDB ‡πÄ‡∏õ‡πá‡∏ô Data Source ‡πÉ‡∏ô Grafana

1.  ‡πÄ‡∏Ç‡πâ‡∏≤ Grafana ‚Üí **Configuration ‚Üí Data Sources**
2.  ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å **InfluxDB**
3.  ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
    -   **URL:** `http://influxdb:8086`\
    -   **Database:** `k6`\
    -   **User / Password:** ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô compose\
    -   **Query Language:** Flux ‡∏´‡∏£‡∏∑‡∏≠ InfluxQL ‡∏ï‡∏≤‡∏° config (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ Flux)
4.  ‡∏Å‡∏î **Save & Test**

------------------------------------------------------------------------

## 5Ô∏è‚É£ ‡πÄ‡∏û‡∏¥‡πà‡∏° Loki ‡πÄ‡∏õ‡πá‡∏ô Data Source

1.  Grafana ‚Üí **Data Sources**
2.  ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å **Loki**
3.  ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
    -   **URL:** `http://loki:3100`
4.  ‡∏Å‡∏î **Save & Test**

------------------------------------------------------------------------

# üöÄ ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô Load Test ‡∏î‡πâ‡∏ß‡∏¢ k6

### 6Ô∏è‚É£ ‡∏£‡∏±‡∏ô load test script

    k6 run k6/scripts/sample-test.js

‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤: - InfluxDB ‚Üí ‡πÉ‡∏ä‡πâ‡∏î‡∏π‡∏ö‡∏ô dashboard - Loki ‚Üí ‡πÉ‡∏ä‡πâ‡∏î‡∏π log
‡∏ú‡πà‡∏≤‡∏ô Explore

------------------------------------------------------------------------

# üìä ‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏ú‡∏• Load Test ‡∏ö‡∏ô Grafana

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° Data Source ‡πÅ‡∏•‡πâ‡∏ß:

### 7Ô∏è‚É£ Import Dashboard K6 ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ

1.  ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Grafana ‚Üí Dashboards ‚Üí Import
2.  ‡πÉ‡∏™‡πà dashboard ID: **2587** (k6 Official Dashboard)
3.  ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Data Source: **InfluxDB**

------------------------------------------------------------------------

# üìÑ ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö Log ‡∏ú‡πà‡∏≤‡∏ô Loki

Grafana ‚Üí **Explore**\
‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Data Source: **Loki**\
‡πÉ‡∏™‡πà query ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:

    {job="promtail"}

------------------------------------------------------------------------

# üéØ ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

-   ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì load ‡∏î‡∏π‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå `sample-test.js`
-   ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå JSON ‚Üí ‡πÅ‡∏Å‡πâ‡πÉ‡∏ô k6 output options
-   ‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡∏±‡∏Å‡∏°‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏±‡∏ö resource limit ‡πÉ‡∏ô docker-compose

------------------------------------------------------------------------

## üìÑ License

‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå LICENSE ‡∏´‡∏≤‡∏Å‡∏°‡∏µ

------------------------------------------------------------------------

## üôã Contact

‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡πÄ‡∏õ‡∏¥‡∏î issue ‡πÉ‡∏ô GitHub repository ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
